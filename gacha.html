<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Gacha 2077 - AG Arcade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #050508;
            --card-bg: #161b22;
            --text-color: #ffffff;

            /* Rarity Colors */
            --common: #7d8590;
            --rare: #00f2ff;
            --epic: #bd00ff;
            --legendary: #ffcc00;
            --mythic: #ff0055;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                radial-gradient(circle at 50% 0%, rgba(189, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(0, 242, 255, 0.1) 0%, transparent 50%);
        }

        /* Header */
        header {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00f2ff, #bd00ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .currency-display {
            display: flex;
            gap: 1.5rem;
        }

        .currency {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .currency i {
            color: var(--legendary);
        }

        /* Main Stage */
        .summon-stage {
            height: 60vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            perspective: 1000px;
        }

        .summon-circle {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.1);
        }

        .summon-circle.active {
            animation: pulse-glow 2s infinite;
        }

        .summon-circle.summoning {
            animation: spin-summon 0.5s linear infinite;
            border-color: var(--mythic);
            box-shadow: 0 0 100px var(--mythic);
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 50px rgba(0, 242, 255, 0.1);
                transform: scale(1);
            }

            50% {
                box-shadow: 0 0 80px rgba(0, 242, 255, 0.3);
                transform: scale(1.05);
            }
        }

        @keyframes spin-summon {
            0% {
                transform: rotate(0deg) scale(1);
            }

            100% {
                transform: rotate(360deg) scale(0.8);
            }
        }

        .core-crystal {
            font-size: 8rem;
            filter: drop-shadow(0 0 20px rgba(0, 242, 255, 0.5));
            transition: all 0.3s;
            cursor: pointer;
        }

        .core-crystal:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 40px rgba(0, 242, 255, 0.8));
        }

        /* Summon Buttons */
        .controls {
            display: flex;
            gap: 2rem;
            margin-top: 3rem;
        }

        .summon-btn {
            background: linear-gradient(135deg, #1a1b26, #0a0b10);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            border-radius: 12px;
            color: #fff;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 160px;
            position: relative;
            overflow: hidden;
        }

        .summon-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }

        .summon-btn:hover::before {
            transform: translateX(100%);
        }

        .summon-btn:hover {
            transform: translateY(-5px);
            border-color: var(--rare);
            box-shadow: 0 10px 30px rgba(0, 242, 255, 0.2);
        }

        .summon-btn.premium {
            border-color: var(--legendary);
        }

        .summon-btn.premium:hover {
            border-color: var(--legendary);
            box-shadow: 0 10px 30px rgba(255, 204, 0, 0.2);
        }

        .btn-label {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .btn-cost {
            font-size: 0.9rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* Results Overlay */
        .results-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            max-width: 1200px;
            width: 100%;
            perspective: 1000px;
        }

        .card-container {
            aspect-ratio: 3/4;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            opacity: 0;
            transform: translateY(50px) rotateY(180deg);
        }

        .card-container.revealed {
            opacity: 1;
            transform: translateY(0) rotateY(0deg);
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            overflow: hidden;
        }

        .card-front {
            background: #161b22;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            position: relative;
            height: 100%;
        }

        /* Rarity Styles */
        .card[data-rarity="common"] .card-front {
            border-color: var(--common);
            box-shadow: 0 0 15px rgba(125, 133, 144, 0.2);
        }

        .card[data-rarity="rare"] .card-front {
            border-color: var(--rare);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        }

        .card[data-rarity="epic"] .card-front {
            border-color: var(--epic);
            box-shadow: 0 0 25px rgba(189, 0, 255, 0.4);
        }

        .card[data-rarity="legendary"] .card-front {
            border-color: var(--legendary);
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
            animation: shine 3s infinite;
        }

        .card[data-rarity="mythic"] .card-front {
            border-color: var(--mythic);
            box-shadow: 0 0 40px rgba(255, 0, 85, 0.6);
            animation: mythic-pulse 2s infinite;
        }

        @keyframes shine {
            0% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(1.3);
            }

            100% {
                filter: brightness(1);
            }
        }

        @keyframes mythic-pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 40px rgba(255, 0, 85, 0.6);
            }

            50% {
                transform: scale(1.02);
                box-shadow: 0 0 60px rgba(255, 0, 85, 0.9);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 40px rgba(255, 0, 85, 0.6);
            }
        }

        .char-image {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05), transparent);
        }

        .char-info {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.6);
            text-align: center;
        }

        .char-name {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .char-rarity {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff0055;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            transform: rotate(15deg);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .close-results {
            margin-top: 3rem;
            background: white;
            color: black;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-results:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* Inventory Section */
        .inventory-section {
            padding: 4rem 2rem;
            background: #0a0b10;
        }

        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            color: #fff;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .inv-item {
            aspect-ratio: 1;
            background: #161b22;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 1px solid #333;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inv-item:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .inv-item[data-rarity="common"] {
            border-color: var(--common);
            color: var(--common);
        }

        .inv-item[data-rarity="rare"] {
            border-color: var(--rare);
            color: var(--rare);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.1);
        }

        .inv-item[data-rarity="epic"] {
            border-color: var(--epic);
            color: var(--epic);
            box-shadow: 0 0 10px rgba(189, 0, 255, 0.2);
        }

        .inv-item[data-rarity="legendary"] {
            border-color: var(--legendary);
            color: var(--legendary);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }

        .inv-item[data-rarity="mythic"] {
            border-color: var(--mythic);
            color: var(--mythic);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.4);
        }

        .inv-count {
            position: absolute;
            bottom: 2px;
            right: 5px;
            font-size: 0.8rem;
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px black;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
        }

        /* Back Button */
        .back-btn {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s;
        }

        .back-btn:hover {
            color: var(--rare);
        }
    </style>
</head>

<body>

    <header>
        <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Arcade</a>
        <div class="brand">NEON GACHA</div>
        <div class="currency-display">
            <div class="currency" title="Credits">
                <i class="fa-solid fa-coins"></i>
                <span id="credits">10000</span>
            </div>
            <div class="currency" title="Gems">
                <i class="fa-solid fa-gem"></i>
                <span id="gems">500</span>
            </div>
        </div>
    </header>

    <div class="summon-stage">
        <div class="summon-circle active" id="summonCircle">
            <div class="core-crystal" id="coreCrystal">ðŸ’Ž</div>
        </div>

        <div class="controls">
            <button class="summon-btn" onclick="summon(1)">
                <span class="btn-label">Summon x1</span>
                <span class="btn-cost"><i class="fa-solid fa-coins"></i> 160</span>
            </button>
            <button class="summon-btn premium" onclick="summon(10)">
                <span class="btn-label">Summon x10</span>
                <span class="btn-cost"><i class="fa-solid fa-coins"></i> 1600</span>
            </button>
        </div>
    </div>

    <div class="inventory-section">
        <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;">
            <button class="summon-btn" onclick="toggleAchievements()"
                style="min-width: auto; flex-direction: row; gap: 0.5rem;">
                <i class="fa-solid fa-trophy" style="color: var(--legendary);"></i> Achievements
            </button>
            <div class="currency" title="Pity Counter"
                style="background: rgba(255, 0, 85, 0.1); border-color: var(--mythic);">
                <i class="fa-solid fa-fire" style="color: var(--mythic);"></i>
                <span id="pityCounter">0</span> / 90
            </div>
        </div>

        <h2 class="section-title">Collection</h2>
        <div class="inventory-grid" id="inventoryGrid">
            <!-- Inventory items will be generated here -->
        </div>
    </div>

    <!-- Results Overlay -->
    <div class="results-overlay" id="resultsOverlay">
        <h2 style="color: white; margin-bottom: 2rem; font-size: 2rem; text-transform: uppercase; letter-spacing: 5px;">
            Summon Results</h2>
        <div class="results-grid" id="resultsGrid">
            <!-- Cards go here -->
        </div>
        <button class="close-results" onclick="closeResults()">CONTINUE</button>
    </div>

    <!-- Achievements Overlay -->
    <div class="results-overlay" id="achievementsOverlay" style="background: rgba(0,0,0,0.9);">
        <h2
            style="color: var(--legendary); margin-bottom: 2rem; font-size: 2rem; text-transform: uppercase; letter-spacing: 2px;">
            <i class="fa-solid fa-trophy"></i> Achievements</h2>
        <div id="achievementsList"
            style="display: flex; flex-direction: column; gap: 1rem; width: 100%; max-width: 600px; max-height: 70vh; overflow-y: auto; padding: 1rem;">
            <!-- Achievements generated here -->
        </div>
        <button class="close-results" onclick="toggleAchievements()">CLOSE</button>
    </div>

    <div class="toast" id="toast">Not enough credits!</div>

    <script>
        // ==========================================
        // DATA & CONFIG
        // ==========================================
        const RARITIES = {
            common: { color: '#7d8590', prob: 0.50, name: 'Common' },
            rare: { color: '#00f2ff', prob: 0.35, name: 'Rare' },
            epic: { color: '#bd00ff', prob: 0.12, name: 'Epic' },
            legendary: { color: '#ffcc00', prob: 0.025, name: 'Legendary' },
            mythic: { color: '#ff0055', prob: 0.005, name: 'Mythic' }
        };

        const CHARACTERS = [
            // Common
            { id: 'c1', name: 'Scrap Bot', rarity: 'common', icon: 'ðŸ¤–' },
            { id: 'c2', name: 'Civilian', rarity: 'common', icon: 'ðŸ‘¨' },
            { id: 'c3', name: 'Street Cat', rarity: 'common', icon: 'ðŸ±' },
            { id: 'c4', name: 'Drone v1', rarity: 'common', icon: 'ðŸš' },
            { id: 'c5', name: 'Vending Machine', rarity: 'common', icon: 'ðŸ¥¤' },

            // Rare
            { id: 'r1', name: 'Hacker', rarity: 'rare', icon: 'ðŸ’»' },
            { id: 'r2', name: 'Medic', rarity: 'rare', icon: 'âš•ï¸' },
            { id: 'r3', name: 'Security Guard', rarity: 'rare', icon: 'ðŸ‘®' },
            { id: 'r4', name: 'Mechanic', rarity: 'rare', icon: 'ðŸ”§' },
            { id: 'r5', name: 'Neon Biker', rarity: 'rare', icon: 'ðŸï¸' },

            // Epic
            { id: 'e1', name: 'Cyber Samurai', rarity: 'epic', icon: 'âš”ï¸' },
            { id: 'e2', name: 'Sniper Elite', rarity: 'epic', icon: 'ðŸŽ¯' },
            { id: 'e3', name: 'Netrunner', rarity: 'epic', icon: 'ðŸŒ' },
            { id: 'e4', name: 'Heavy Mech', rarity: 'epic', icon: 'ðŸ¦¾' },

            // Legendary
            { id: 'l1', name: 'Dragon Lord', rarity: 'legendary', icon: 'ðŸ‰' },
            { id: 'l2', name: 'AI Overmind', rarity: 'legendary', icon: 'ðŸ§ ' },
            { id: 'l3', name: 'Time Traveler', rarity: 'legendary', icon: 'â³' },

            // Mythic
            { id: 'm1', name: 'Glitch God', rarity: 'mythic', icon: 'ðŸ‘¾' },
            { id: 'm2', name: 'Cosmic Entity', rarity: 'mythic', icon: 'ðŸŒŒ' }
        ];

        const ACHIEVEMENTS = [
            { id: 'first_pull', title: 'First Step', desc: 'Perform your first summon', icon: 'ðŸŽ²' },
            { id: 'big_spender', title: 'High Roller', desc: 'Perform a x10 summon', icon: 'ðŸ’¸' },
            { id: 'lucky', title: 'Golden Touch', desc: 'Get a Legendary character', icon: 'ðŸ‘‘' },
            { id: 'god_mode', title: 'THE CHOSEN ONE', desc: 'Get a Mythic character', icon: 'âš›ï¸' },
            { id: 'collector', title: 'Collector', desc: 'Own 10 unique characters', icon: 'ðŸ“š' },
            { id: 'pity_hit', title: 'Bad Luck Protection', desc: 'Reach 90 pity', icon: 'ðŸ›¡ï¸' }
        ];

        let state = {
            credits: 10000,
            gems: 500,
            inventory: {}, // id -> count
            pity: 0,
            unlockedAchievements: []
        };

        // Load state from local storage
        const savedState = localStorage.getItem('neon_gacha_save');
        if (savedState) {
            state = { ...state, ...JSON.parse(savedState) }; // Merge to ensure new fields exist
        }

        // ==========================================
        // AUDIO SYSTEM
        // ==========================================
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(freq, type, duration, time = 0) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + time);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime + time);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + time + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + time);
            osc.stop(audioCtx.currentTime + time + duration);
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            if (type === 'tick') {
                playTone(800, 'square', 0.05);
            } else if (type === 'reveal_common') {
                playTone(400, 'sine', 0.2);
            } else if (type === 'reveal_rare') {
                playTone(600, 'sine', 0.3);
                playTone(800, 'sine', 0.3, 0.1);
            } else if (type === 'reveal_epic') {
                playTone(400, 'sawtooth', 0.4);
                playTone(600, 'sawtooth', 0.4, 0.1);
                playTone(800, 'sawtooth', 0.4, 0.2);
            } else if (type === 'reveal_legendary') {
                // Fanfare
                [440, 554, 659, 880].forEach((f, i) => playTone(f, 'square', 0.5, i * 0.1));
            } else if (type === 'reveal_mythic') {
                // Deep rumble + high pitch
                playTone(100, 'sawtooth', 1.0);
                playTone(50, 'square', 1.0);
                [1000, 1200, 1500, 2000].forEach((f, i) => playTone(f, 'sine', 0.5, i * 0.05));
            } else if (type === 'achievement') {
                playTone(1000, 'sine', 0.1);
                playTone(1500, 'sine', 0.3, 0.1);
            }
        }

        // ==========================================
        // LOGIC
        // ==========================================
        function updateUI() {
            document.getElementById('credits').innerText = state.credits;
            document.getElementById('gems').innerText = state.gems;
            document.getElementById('pityCounter').innerText = state.pity;
            renderInventory();
            localStorage.setItem('neon_gacha_save', JSON.stringify(state));
        }

        function unlockAchievement(id) {
            if (!state.unlockedAchievements.includes(id)) {
                state.unlockedAchievements.push(id);
                const ach = ACHIEVEMENTS.find(a => a.id === id);
                showToast(`ðŸ† Unlocked: ${ach.title}`);
                playSound('achievement');
                updateUI();
            }
        }

        function checkAchievements(results) {
            if (results) {
                unlockAchievement('first_pull');
                if (results.length >= 10) unlockAchievement('big_spender');
                if (results.some(c => c.rarity === 'legendary')) unlockAchievement('lucky');
                if (results.some(c => c.rarity === 'mythic')) unlockAchievement('god_mode');
            }

            if (Object.keys(state.inventory).length >= 10) unlockAchievement('collector');
            if (state.pity >= 90) unlockAchievement('pity_hit');
        }

        function getRandomChar() {
            // Pity Logic
            state.pity++;
            let currentRarities = { ...RARITIES };

            // Hard Pity at 90
            if (state.pity >= 90) {
                state.pity = 0;
                const legendaries = CHARACTERS.filter(c => c.rarity === 'legendary');
                return legendaries[Math.floor(Math.random() * legendaries.length)];
            }

            // Soft Pity starts at 75 (increase legendary chance)
            if (state.pity > 75) {
                currentRarities.legendary.prob += 0.1;
            }

            const rand = Math.random();
            let cumulative = 0;
            let selectedRarity = 'common';

            for (const [rarity, data] of Object.entries(currentRarities)) {
                cumulative += data.prob;
                if (rand <= cumulative) {
                    selectedRarity = rarity;
                    break;
                }
            }

            // Reset pity if legendary or mythic
            if (selectedRarity === 'legendary' || selectedRarity === 'mythic') {
                state.pity = 0;
            }

            const pool = CHARACTERS.filter(c => c.rarity === selectedRarity);
            return pool[Math.floor(Math.random() * pool.length)];
        }

        function summon(count) {
            const cost = count * 160;
            if (state.credits < cost) {
                showToast("Not enough credits!");
                return;
            }

            state.credits -= cost;
            updateUI();

            // Animation Phase
            const circle = document.getElementById('summonCircle');
            const crystal = document.getElementById('coreCrystal');

            circle.classList.add('summoning');
            crystal.style.transform = 'scale(0.5) rotate(720deg)';

            // Play ticking sound
            let ticks = 0;
            const tickInterval = setInterval(() => {
                playSound('tick');
                ticks++;
                if (ticks > 10) clearInterval(tickInterval);
            }, 100);

            setTimeout(() => {
                circle.classList.remove('summoning');
                crystal.style.transform = 'scale(1) rotate(0deg)';

                // Generate Results
                const results = [];
                for (let i = 0; i < count; i++) {
                    results.push(getRandomChar());
                }

                checkAchievements(results);
                showResults(results);
            }, 1500);
        }

        function showResults(results) {
            const overlay = document.getElementById('resultsOverlay');
            const grid = document.getElementById('resultsGrid');
            grid.innerHTML = '';
            overlay.style.display = 'flex';

            results.forEach((char, index) => {
                // Add to inventory
                const isNew = !state.inventory[char.id];
                state.inventory[char.id] = (state.inventory[char.id] || 0) + 1;

                const cardContainer = document.createElement('div');
                cardContainer.className = 'card-container';

                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('data-rarity', char.rarity);

                card.innerHTML = `
                    <div class="card-front">
                        ${isNew ? '<div class="new-badge">NEW!</div>' : ''}
                        <div class="char-image">${char.icon}</div>
                        <div class="char-info">
                            <div class="char-name">${char.name}</div>
                            <div class="char-rarity" style="color: ${RARITIES[char.rarity].color}">${char.rarity}</div>
                        </div>
                    </div>
                `;

                cardContainer.appendChild(card);
                grid.appendChild(cardContainer);

                // Staggered reveal
                setTimeout(() => {
                    cardContainer.classList.add('revealed');
                    playSound(`reveal_${char.rarity}`);

                    // Shake effect for high rarity
                    if (char.rarity === 'legendary' || char.rarity === 'mythic') {
                        document.body.style.transform = `translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px)`;
                        setTimeout(() => document.body.style.transform = 'none', 200);
                    }

                }, index * 200 + 500);
            });

            updateUI();
        }

        function closeResults() {
            document.getElementById('resultsOverlay').style.display = 'none';
        }

        function toggleAchievements() {
            const overlay = document.getElementById('achievementsOverlay');
            const list = document.getElementById('achievementsList');

            if (overlay.style.display === 'flex') {
                overlay.style.display = 'none';
            } else {
                list.innerHTML = '';
                ACHIEVEMENTS.forEach(ach => {
                    const unlocked = state.unlockedAchievements.includes(ach.id);
                    const el = document.createElement('div');
                    el.style.cssText = `
                        background: ${unlocked ? 'rgba(0, 242, 255, 0.1)' : 'rgba(255,255,255,0.05)'};
                        border: 1px solid ${unlocked ? 'var(--rare)' : 'rgba(255,255,255,0.1)'};
                        padding: 1rem;
                        border-radius: 10px;
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                        opacity: ${unlocked ? 1 : 0.5};
                    `;
                    el.innerHTML = `
                        <div style="font-size: 2rem;">${unlocked ? ach.icon : 'ðŸ”’'}</div>
                        <div>
                            <div style="font-weight: bold; color: ${unlocked ? '#fff' : '#888'}">${ach.title}</div>
                            <div style="font-size: 0.9rem; color: #888;">${ach.desc}</div>
                        </div>
                        ${unlocked ? '<i class="fa-solid fa-check" style="margin-left: auto; color: var(--rare);"></i>' : ''}
                    `;
                    list.appendChild(el);
                });
                overlay.style.display = 'flex';
                overlay.style.alignItems = 'center';
                overlay.style.justifyContent = 'center';
            }
        }

        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = '';

            // Sort inventory by rarity (Mythic -> Common)
            const rarityOrder = { mythic: 5, legendary: 4, epic: 3, rare: 2, common: 1 };

            const ownedChars = Object.keys(state.inventory).map(id => {
                return CHARACTERS.find(c => c.id === id);
            }).sort((a, b) => rarityOrder[b.rarity] - rarityOrder[a.rarity]);

            ownedChars.forEach(char => {
                const count = state.inventory[char.id];
                const el = document.createElement('div');
                el.className = 'inv-item';
                el.setAttribute('data-rarity', char.rarity);
                el.title = `${char.name} (${char.rarity})`;
                el.innerHTML = `
                    ${char.icon}
                    <div class="inv-count">x${count}</div>
                `;
                grid.appendChild(el);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Init
        updateUI();

        // Free credits loop
        setInterval(() => {
            if (state.credits < 1000) {
                state.credits += 10;
                updateUI();
            }
        }, 1000);

    </script>
</body>

</html>